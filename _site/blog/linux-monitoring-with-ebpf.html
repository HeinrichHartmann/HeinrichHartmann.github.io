<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
   <title>Monitoring Linux with eBPF</title>
   <meta name="author" content="Heinrich Hartmann"/>

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css"/>

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection"/>

   <!-- RSS feed -->
   <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

   <!-- Favicon -->
   <link rel="icon" type="image/png" href="/images/favicon.png">

   
   <!-- Canonical source -->
   <link rel="canonical" href="https://www.circonus.com/2018/02/circonus-raspberry-pi/"/>
   
   </head>
<body>

<div class="site">
  <div class="title">
    <a href="/">Heinrich Hartmann</a>
    <a class="extra" href="/opinion.html">opinion</a>
    <a class="extra" href="/consulting.html">consulting</a>
    <a class="extra" href="/about.html">about</a>
    <div class="social" style='float:right'>
      <!-- <div style='float:right'> -->
      <!--   <a href="http://eepurl.com/ccmH-T"><img src="/images/mail_icon.svg" width="25px"/></a> -->
      <!-- </div> -->
      <div style='float:right'>
        <a href="/feed.xml"><img src="/images/rss_icon.svg" width="25px" style="margin: 0 10px 0 0;"/></a>
      </div>
      <div style='float:right'>
        <a href="http://twitter.com/intent/follow?screen_name=HeinrichHartman"><img src="/images/twitter_icon.svg" width="25px" style="margin: 0 10px 0 0;"></a>
      </div>
    </div>
  </div>
  

  <div id="post">

  <!-- Title -->
  <h1> Monitoring Linux with eBPF</h1>

  
  <h1 class="sticker"> UNPUBLISHED DRAFT </h1>
  


  <!-- Meta -->
  <p class="meta">
    Written on 2018-04-29
     in Zurich, Swizerland 
     for the <a href="https://www.circonus.com/2018/02/circonus-raspberry-pi/">Circonus blog</a>. 
  </p>

  <!-- Splash -->
  

  <!-- Post content -->
  <p>The Linux kernel is an abundant component of modern IT systems.
It provides the critical services of hardware abstraction and time-sharing to applications.
For the correct and performant operation of your system it’s critical to monitor the kernel as well as the application.</p>

<p>The classical metrics for monitoring Linux, are among the most well known metrics in monitoring at all:
CPU utilization, Memory usage (RSS-size), File system usage, and Network throughout.
Those metrics focus on the kernel’s role as resource manager.</p>

<p>A systematic view on system resources is the USE Method suggested by Brendan Gregg (http://www.brendangregg.com/usemethod.html).
With the USE Dashboard, Circonus offers a high level overview over the key services that the Linux kernel provides to the application.
https://www.circonus.com/2017/08/system-monitoring-with-the-use-dashboard/</p>

<p>Monitoring these metrics provides clear value, but leaves a lot of things to be wished for.
Even the most basic metrics like CPU utilization have some serious flaws (https://www.youtube.com/watch?v=QkcBASKLyeU) that limit the usefullness of those metrics.
Also there are a lot of questions, for which there are simply no metrics.
How much time did process X spent on CPU? How much time</p>

<p>eBPF is a game changing technology that is available in recent kernel versions (v4.1 and later, cf https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md, e.g Ubuntu 16.04)
It allows to subscribe to a large variety of in kernel events (function calls, k_probes) and aggregate them with minimal overhead.
This unlocks a wide range of meaningful precise measurements, that can help narrowing the observability gap.</p>

<p>The Circonus Monitoring Agent comes with an bpf plugin that allows to collect ebpf metrics from the Linux kernel.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/circonus-labs/nad/tree/master/plugins/linux/bccbpf
</code></pre></div></div>

<p>The agent as well as the plugin are open source under a BSD license.
The plugin makes use of the iovisor bcc toolkit (https://github.com/iovisor/bcc).
At the time of this writing the plugin is supported on the Ubuntu 16.04 platform.</p>

<p>In the following we will show some examples how this information can be used for monitoring purposes.</p>


  <!-- Comments -->
  
    Comments have been disabled until the dust around the GDPR settled.
    <!-- <div id="disqus_thread"></div> -->
    <!-- <script type="text/javascript"> -->
    <!--   /* * * CONFIGURATION VARIABLES * * */ -->
    <!--   var disqus_shortname = 'heinrichhartmann'; -->
    <!--   /* * * DON'T EDIT BELOW THIS LINE * * */ -->
    <!--   (function() { -->
    <!--   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; -->
    <!--   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; -->
    <!--   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); -->
    <!--   })(); -->
    <!-- </script> -->
    <!-- <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments</a></noscript> -->
  

</div>


  <div class="footer">
    <div class="contact">
      <p>
        Licensed under <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC-BY 4.0.</a>
        <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title" style="display:none">This blog</span>
        <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName" style="display:none">Heinrich Hartmann</span>
      </p>
    </div>
  </div>
</div>



<!-- Google Analytics -->

<!-- <script> -->
<!--   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ -->
<!--   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), -->
<!--   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) -->
<!--   })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); -->

<!--   ga('create', 'UA-53959000-1', 'auto'); -->
<!--   ga('send', 'pageview'); -->
<!-- </script> -->

</body>
</html>
