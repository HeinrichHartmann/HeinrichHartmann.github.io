<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
   <title>Circonus on the Raspberry Pi</title>
   <meta name="author" content="Heinrich Hartmann"/>

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css"/>

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection"/>

   <!-- RSS feed -->
   <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

   <!-- Favicon -->
   <link rel="icon" type="image/png" href="/images/favicon.png">
   </head>
<body>

<div class="site">
  <div class="title">
    <a href="/">Heinrich Hartmann</a>
    <a class="extra" href="/opinion.html">opinion</a>
    <a class="extra" href="/consulting.html">consulting</a>
    <a class="extra" href="/about.html">about</a>
    <div style='float:right'>
      <a href="http://eepurl.com/ccmH-T"><img src="/images/mail_icon.svg" width="25px"/></a>
    </div>
    <div style='float:right'>
      <a href="/feed.xml"><img src="/images/rss_icon.svg" width="25px" style="margin: 0 10px 0 0;"/></a>
    </div>
    <div style='float:right'>
      <a href="http://twitter.com/intent/follow?screen_name=HeinrichHartman"><img src="/images/twitter_icon.svg" width="25px" style="margin: 0 10px 0 0;"></a>
    </div>
  </div>

  <div id="post">
  <!-- Title -->
  <h1> Circonus on the Raspberry Pi</h1>

  <!-- Meta -->
  <p class="meta">
    Written on 2018-02-13
     in Stemwede, Germany 
  </p>

  
  <h1 style="color:red"> UNPUBLISHED DRAFT </h1>
  

  <!-- Splash -->
  

  <!-- Post content -->
  <p>There are a lot of interesting monitoring tasks, that can facilitated with a Raspberry Pi (E.g. <a href="http://heinrichhartmann.com/blog/2014/12/14/Sensor-Monitoring-with-RaspberryPi-and-Circonus.html">here</a>, <a href="https://www.circonus.com/2016/10/circonus-api-raspberry-pi/">here</a>.</p>

<p>Unfortunately installing the Circonus monitoring agent on the Pi is not entirely straitght forward.</p>
<ul>
  <li>The linux distribution “Raspian” is not directly supported, and neither is its upstream distro Debian Wheezy.</li>
  <li>The processor architecture (armv6/v7) requires different binaries than supported targets.</li>
  <li>Setting up nodejs/npm correctly is a PITA.</li>
</ul>

<p>But hold-on. Not all is lost. Here is how you do it with a little more effort:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install dependencies</span>
<span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get install git make

<span class="c"># Only node node v4 or node v6 are supported. Install official arm package</span>
wget https://nodejs.org/dist/latest-v6.x/node-v6.12.3-linux-armv6l.tar.xz
<span class="nb">sudo </span>mkdir <span class="nt">-p</span> /opt/node
<span class="nb">sudo tar</span> <span class="nt">-vxf</span> node-v6.12.3-linux-armv6l.tar.xz <span class="nt">-C</span> /opt/node <span class="nt">--strip-components</span><span class="o">=</span>1
<span class="nb">sudo </span>ln <span class="nt">-s</span> /opt/node/bin/node /usr/bin/node
<span class="nb">sudo </span>ln <span class="nt">-s</span> /opt/node/bin/npm /usr/bin/npm
<span class="nb">sudo </span>ln <span class="nt">-s</span> /opt/node/bin/node /opt/circonus/bin/node

<span class="c"># Install nad from sources</span>
git clone https://github.com/circonus-labs/nad.git
<span class="nb">cd </span>nad
git checkout v2.5.1
<span class="nb">sudo </span>make install install-linux-init
</code></pre></div></div>

<p>This should install and enable the monitoring agent nad on the RPI.
Check that it is up and running using:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Is it up?</span>
systemctl status nad
<span class="c"># Does it serve metrics?</span>
curl localhost:2609
</code></pre></div></div>

<p>Now copy paste the one-step-install command from the Integrations &gt; Checks &gt; [New Host] page.
In my case this is:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sSL</span> https://onestep.circonus.com/install | bash <span class="se">\</span>
   <span class="nt">-s</span> <span class="nt">--</span> <span class="se">\</span>
   <span class="nt">--key</span> xxxxxxxxx-50ce-4118-9145-xxxxxxxxxx <span class="se">\</span>
   <span class="nt">--app</span> circonus:osi:xxxxxx...
</code></pre></div></div>

<p>The credentials will be different for you.
The installer should find the running agent and register checks, graphs and the <a href="https://www.circonus.com/2017/08/system-monitoring-with-the-use-dashboard/">USE Dashboard</a> for you.
We needed to make some tweaks to the COSI installer itself to get this working as it is now.
Thanks to Matt Maier @ Circonus to make this possible.</p>

<p>These instructions were tested on <a href="https://www.raspberrypi.org/downloads/raspbian/">raspbian stretch lite</a>
Version: November 2017 / Release date: 2017-11-29 / Kernel version: 4.9
on a RPI2 Model B.</p>

<p>Happy Monitoring!</p>


  <!-- Comments -->
  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES * * */
      var disqus_shortname = 'heinrichhartmann';
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments</a></noscript>
  
</div>


  <div class="footer">
    <div class="contact">
      <p>
        Licensed under <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC-BY 4.0.</a>
        <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title" style="display:none">This blog</span>
        <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName" style="display:none">Heinrich Hartmann</span>
      </p>
    </div>
  </div>
</div>

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53959000-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
